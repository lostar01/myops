version: '2'

services:
  jenkins:
    restart: always
    container_name: jenkins
    image: registry.mydomain.com/jenkins:v2
    cpu_shares: 70
    mem_limit: 2048M
    extra_hosts:
    - "registry.mydomain.com:120.25.86.186"
    ports:
    - "9090:8080"
    volumes:
    - /data/docker/jenkins:/jenkins:Z
    - /usr/bin/docker:/usr/bin/docker
    - /var/run/docker.sock:/var/run/docker.sock
    - /usr/lib/x86_64-linux-gnu/libltdl.so.7:/usr/lib/x86_64-linux-gnu/libltdl.so.7
    - /usr/share/zoneinfo/Asia/Shanghai:/usr/share/zoneinfo/Asia/Shanghai
    - /etc/docker/certs.d/registry.mydomain.com/ca.crt:/etc/docker/certs.d/registry.mydomain.com/ca.crt
    - /root/.kube:/root/.kube
    - /opt/script/kube_cli.py:/opt/script/kube_cli.py
    - /usr/bin/python:/usr/bin/python
    - /usr/bin/python2.7:/usr/bin/python2.7
    - /usr/local/lib/python2.7/dist-packages/cloud_init-0.7.6-py2.7.egg:/usr/local/lib/python2.7/dist-packages/cloud_init-0.7.6-py2.7.egg
    - /usr/local/lib/python2.7/dist-packages:/usr/local/lib/python2.7/dist-packages
    - /usr/lib/python2.7:/usr/lib/python2.7
    - /usr/lib/python2.7/plat-x86_64-linux-gnu:/usr/lib/python2.7/plat-x86_64-linux-gnu
    - /usr/lib/python2.7/lib-tk:/usr/lib/python2.7/lib-tk
    - /usr/lib/python2.7/lib-dynload:/usr/lib/python2.7/lib-dynload
    - /usr/local/lib/python2.7/dist-packages:/usr/local/lib/python2.7/dist-packages
    - /usr/lib/python2.7/dist-packages:/usr/lib/python2.7/dist-packages
    environment:
    - DEBUG=false
